<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerenciador de Tarefas</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    /* Navigation */
    nav {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    nav ul {
      list-style: none;
      display: flex;
      justify-content: center;
      padding: 15px 0;
    }

    nav li {
      margin: 0 20px;
    }

    nav a {
      text-decoration: none;
      color: #333;
      font-weight: 600;
      padding: 10px 20px;
      border-radius: 25px;
      transition: all 0.3s ease;
    }

    nav a:hover {
      background: #667eea;
      color: white;
      transform: translateY(-2px);
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    .header h1 {
      color: white;
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    /* Filters */
    .filters {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .filters h3 {
      margin-bottom: 20px;
      color: #333;
      text-align: center;
    }

    .filter-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .filter-group {
      display: flex;
      flex-direction: column;
    }

    .filter-group label {
      margin-bottom: 5px;
      font-weight: 600;
      color: #555;
    }

    .filter-group input,
    .filter-group select {
      padding: 12px;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s ease;
    }

    .filter-group input:focus,
    .filter-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    .filter-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5a67d8;
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: #e2e8f0;
      color: #4a5568;
    }

    .btn-secondary:hover {
      background: #cbd5e0;
    }

    /* Charts */
    .charts-section {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
    }

    .chart-container {
      text-align: center;
    }

    .chart-container h4 {
      margin-bottom: 15px;
      color: #333;
    }

    .chart {
      width: 200px;
      height: 200px;
      margin: 0 auto;
      position: relative;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .stat-card {
      background: #f7fafc;
      padding: 15px;
      border-radius: 10px;
      text-align: center;
      border-left: 4px solid #667eea;
    }

    .stat-number {
      font-size: 2rem;
      font-weight: bold;
      color: #667eea;
    }

    .stat-label {
      font-size: 0.9rem;
      color: #666;
      margin-top: 5px;
    }

    /* Table */
    .table-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid #e2e8f0;
    }

    th {
      background: #f7fafc;
      font-weight: 600;
      color: #4a5568;
      position: sticky;
      top: 0;
    }

    tr:hover {
      background: #f7fafc;
    }

    /* Status */
    .status-select {
      padding: 8px 12px;
      border: 2px solid #e2e8f0;
      border-radius: 20px;
      background: white;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .status-nao-iniciada {
      border-color: #e53e3e;
      color: #e53e3e;
    }

    .status-iniciada {
      border-color: #dd6b20;
      color: #dd6b20;
    }

    .status-concluida {
      border-color: #38a169;
      color: #38a169;
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Alert */
    .alert {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 10px;
      color: white;
      font-weight: 600;
      z-index: 1000;
      transform: translateX(400px);
      transition: transform 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .alert.show {
      transform: translateX(0);
    }

    .alert-success {
      background: #38a169;
    }

    .alert-error {
      background: #e53e3e;
    }

    .alert-info {
      background: #3182ce;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }

      .header h1 {
        font-size: 2rem;
      }

      nav ul {
        flex-direction: column;
        gap: 10px;
      }

      .filter-row {
        grid-template-columns: 1fr;
      }

      .charts-grid {
        grid-template-columns: 1fr;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      table {
        font-size: 14px;
      }

      th, td {
        padding: 10px 8px;
      }
    }

    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }

      .filter-buttons {
        flex-direction: column;
      }

      .btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <nav>
      <ul>
        <li><a href="index.html">üìã Tarefas</a></li>
        <li><a href="cadastro.html">‚ûï Cadastro</a></li>
      </ul>
    </nav>

    <div class="header">
      <h1>üìã Gerenciador de Tarefas</h1>
    </div>

    
    <div class="filters">
      <h3>üîç Filtros</h3>
      <div class="filter-row">
        <div class="filter-group">
          <label for="filterName">Nome da Tarefa:</label>
          <input type="text" id="filterName" placeholder="Digite o nome da tarefa...">
        </div>
        <div class="filter-group">
          <label for="filterStatus">Situa√ß√£o:</label>
          <select id="filterStatus">
            <option value="">Todas as situa√ß√µes</option>
            <option value="N√£o Iniciada">N√£o Iniciada</option>
            <option value="Iniciada">Iniciada</option>
            <option value="Conclu√≠da">Conclu√≠da</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="filterDate">Data:</label>
          <input type="date" id="filterDate">
        </div>
        <div class="filter-group">
          <label for="filterCategory">Categoria:</label>
          <select id="filterCategory">
            <option value="">Todas as categorias</option>
            <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
            <option value="Vestu√°rio">Vestu√°rio</option>
            <option value="Limpeza">Limpeza</option>
          </select>
        </div>
      </div>
      <div class="filter-buttons">
        <button class="btn btn-primary" onclick="applyFilters()">üîç Aplicar Filtros</button>
        <button class="btn btn-secondary" onclick="clearFilters()">üóëÔ∏è Limpar Filtros</button>
        <button class="btn btn-primary" onclick="loadData()">üîÑ Atualizar Dados</button>
      </div>
    </div>

 
    <div class="charts-section">
      <h3 style="text-align: center; margin-bottom: 25px;">üìä Estat√≠sticas das Tarefas</h3>
      <div class="charts-grid">
        <div class="chart-container">
          <h4>Distribui√ß√£o por Status</h4>
          <canvas id="statusChart" class="chart"></canvas>
        </div>
        <div class="chart-container">
          <h4>Tarefas por Categoria</h4>
          <canvas id="categoryChart" class="chart"></canvas>
        </div>
      </div>
      <div class="stats-grid" id="statsGrid">
         Stats will be populated by JavaScript 
      </div>
    </div>

     
    <div class="table-container">
      <h3>üìù Lista de Tarefas</h3>
      <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Carregando tarefas...</p>
      </div>
      <table id="tabela" style="display: none;">
        <thead></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

    
  <div id="alertContainer"></div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycby6rrcRZUmSKgFeElNPpoH3ZDj1sattBE6ijxntSziLYrxtGZILs07R8ZMiXF0-WG6Z/exec";
    let allTasks = [];
    let filteredTasks = [];

    // Load data on page load
    document.addEventListener('DOMContentLoaded', function() {
      loadData();
    });

    function showAlert(message, type = 'info') {
      const alertContainer = document.getElementById('alertContainer');
      const alert = document.createElement('div');
      alert.className = `alert alert-${type}`;
      alert.textContent = message;
      
      alertContainer.appendChild(alert);
      
      setTimeout(() => {
        alert.classList.add('show');
      }, 100);
      
      setTimeout(() => {
        alert.classList.remove('show');
        setTimeout(() => {
          alertContainer.removeChild(alert);
        }, 300);
      }, 3000);
    }

    function loadData() {
      const loading = document.getElementById('loading');
      const table = document.getElementById('tabela');
      
      loading.style.display = 'block';
      table.style.display = 'none';

      fetch(API_URL)
        .then(res => {
          if (!res.ok) {
            throw new Error('Erro na resposta da API');
          }
          return res.json();
        })
        .then(data => {
          allTasks = data.map((task, index) => ({
            ...task,
            id: index,
            Situacao: task.Situacao || 'N√£o Iniciada',
            Data: task.Data || new Date().toISOString().split('T')[0]
          }));
          
          filteredTasks = [...allTasks];
          renderTable();
          renderCharts();
          renderStats();
          
          loading.style.display = 'none';
          table.style.display = 'table';
          
          showAlert('Tarefas carregadas com sucesso!', 'success');
        })
        .catch(err => {
          console.error("Erro ao buscar dados:", err);
          loading.style.display = 'none';
          showAlert('Erro ao carregar tarefas. Tente novamente.', 'error');
        });
    }

    function renderTable() {
      const table = document.getElementById("tabela");
      const thead = table.querySelector("thead");
      const tbody = table.querySelector("tbody");

      if (filteredTasks.length === 0) {
        thead.innerHTML = "";
        tbody.innerHTML = "<tr><td colspan='999' style='text-align: center; padding: 40px; color: #666;'>üì≠ Nenhuma tarefa encontrada</td></tr>";
        return;
      }

      // Headers
      const headers = ['Situa√ß√£o', ...Object.keys(filteredTasks[0]).filter(key => key !== 'id' && key !== 'Situacao')];
      thead.innerHTML = "<tr>" + headers.map(h => `<th>${h}</th>`).join('') + "</tr>";

      // Rows
      tbody.innerHTML = filteredTasks.map(task => {
        const statusOptions = ['N√£o Iniciada', 'Iniciada', 'Conclu√≠da'];
        const statusSelect = `
          <select class="status-select status-${task.Situacao.toLowerCase().replace(' ', '-')}" 
                  onchange="updateTaskStatus(${task.id}, this.value)">
            ${statusOptions.map(status => 
              `<option value="${status}" ${status === task.Situacao ? 'selected' : ''}>${status}</option>`
            ).join('')}
          </select>
        `;
        
        const otherCells = Object.keys(task)
          .filter(key => key !== 'id' && key !== 'Situacao')
          .map(key => `<td>${task[key] || ''}</td>`)
          .join('');
        
        return `<tr><td>${statusSelect}</td>${otherCells}</tr>`;
      }).join('');
    }

    function updateTaskStatus(taskId, newStatus) {
      const task = allTasks.find(t => t.id === taskId);
      if (task) {
        task.Situacao = newStatus;
        
        // Update filtered tasks if it exists there
        const filteredTask = filteredTasks.find(t => t.id === taskId);
        if (filteredTask) {
          filteredTask.Situacao = newStatus;
        }
        
        renderCharts();
        renderStats();
        showAlert(`Status da tarefa atualizado para: ${newStatus}`, 'success');
        
        // Here you could also send the update to Google Sheets if needed
        // updateTaskInSheet(task);
      }
    }

    function applyFilters() {
      const nameFilter = document.getElementById('filterName').value.toLowerCase();
      const statusFilter = document.getElementById('filterStatus').value;
      const dateFilter = document.getElementById('filterDate').value;
      const categoryFilter = document.getElementById('filterCategory').value;

      filteredTasks = allTasks.filter(task => {
        const matchesName = !nameFilter || 
          (task.Descri√ßao && task.Descri√ßao.toLowerCase().includes(nameFilter));
        const matchesStatus = !statusFilter || task.Situacao === statusFilter;
        const matchesDate = !dateFilter || task.Data === dateFilter;
        const matchesCategory = !categoryFilter || task.Categoria === categoryFilter;

        return matchesName && matchesStatus && matchesDate && matchesCategory;
      });

      renderTable();
      renderCharts();
      renderStats();
      showAlert(`Filtros aplicados. ${filteredTasks.length} tarefa(s) encontrada(s).`, 'info');
    }

    function clearFilters() {
      document.getElementById('filterName').value = '';
      document.getElementById('filterStatus').value = '';
      document.getElementById('filterDate').value = '';
      document.getElementById('filterCategory').value = '';
      
      filteredTasks = [...allTasks];
      renderTable();
      renderCharts();
      renderStats();
      showAlert('Filtros limpos!', 'info');
    }

    function renderCharts() {
      renderStatusChart();
      renderCategoryChart();
    }

    function renderStatusChart() {
      const canvas = document.getElementById('statusChart');
      const ctx = canvas.getContext('2d');
      
      // Count tasks by status
      const statusCounts = {
        'N√£o Iniciada': 0,
        'Iniciada': 0,
        'Conclu√≠da': 0
      };
      
      filteredTasks.forEach(task => {
        statusCounts[task.Situacao] = (statusCounts[task.Situacao] || 0) + 1;
      });

      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // Draw pie chart
      const total = Object.values(statusCounts).reduce((a, b) => a + b, 0);
      if (total === 0) return;

      const colors = {
        'N√£o Iniciada': '#e53e3e',
        'Iniciada': '#dd6b20',
        'Conclu√≠da': '#38a169'
      };

      let currentAngle = 0;
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = Math.min(centerX, centerY) - 10;

      Object.entries(statusCounts).forEach(([status, count]) => {
        if (count > 0) {
          const sliceAngle = (count / total) * 2 * Math.PI;
          
          ctx.beginPath();
          ctx.moveTo(centerX, centerY);
          ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
          ctx.closePath();
          ctx.fillStyle = colors[status];
          ctx.fill();
          
          // Add label
          const labelAngle = currentAngle + sliceAngle / 2;
          const labelX = centerX + Math.cos(labelAngle) * (radius * 0.7);
          const labelY = centerY + Math.sin(labelAngle) * (radius * 0.7);
          
          ctx.fillStyle = 'white';
          ctx.font = 'bold 12px Arial';
          ctx.textAlign = 'center';
          ctx.fillText(count.toString(), labelX, labelY);
          
          currentAngle += sliceAngle;
        }
      });
    }

    function renderCategoryChart() {
      const canvas = document.getElementById('categoryChart');
      const ctx = canvas.getContext('2d');
      
      // Count tasks by category
      const categoryCounts = {};
      filteredTasks.forEach(task => {
        const category = task.Categoria || 'Sem Categoria';
        categoryCounts[category] = (categoryCounts[category] || 0) + 1;
      });

      // Clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      const total = Object.values(categoryCounts).reduce((a, b) => a + b, 0);
      if (total === 0) return;

      const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe'];
      let currentAngle = 0;
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = Math.min(centerX, centerY) - 10;

      Object.entries(categoryCounts).forEach(([category, count], index) => {
        if (count > 0) {
          const sliceAngle = (count / total) * 2 * Math.PI;
          
          ctx.beginPath();
          ctx.moveTo(centerX, centerY);
          ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
          ctx.closePath();
          ctx.fillStyle = colors[index % colors.length];
          ctx.fill();
          
          // Add label
          const labelAngle = currentAngle + sliceAngle / 2;
          const labelX = centerX + Math.cos(labelAngle) * (radius * 0.7);
          const labelY = centerY + Math.sin(labelAngle) * (radius * 0.7);
          
          ctx.fillStyle = 'white';
          ctx.font = 'bold 12px Arial';
          ctx.textAlign = 'center';
          ctx.fillText(count.toString(), labelX, labelY);
          
          currentAngle += sliceAngle;
        }
      });
    }

    function renderStats() {
      const statsGrid = document.getElementById('statsGrid');
      
      const total = filteredTasks.length;
      const completed = filteredTasks.filter(t => t.Situacao === 'Conclu√≠da').length;
      const inProgress = filteredTasks.filter(t => t.Situacao === 'Iniciada').length;
      const notStarted = filteredTasks.filter(t => t.Situacao === 'N√£o Iniciada').length;
      const completionRate = total > 0 ? Math.round((completed / total) * 100) : 0;

      statsGrid.innerHTML = `
        <div class="stat-card">
          <div class="stat-number">${total}</div>
          <div class="stat-label">Total de Tarefas</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${completed}</div>
          <div class="stat-label">Conclu√≠das</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${inProgress}</div>
          <div class="stat-label">Em Andamento</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${notStarted}</div>
          <div class="stat-label">N√£o Iniciadas</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${completionRate}%</div>
          <div class="stat-label">Taxa de Conclus√£o</div>
        </div>
      `;
    }

    // Set canvas size
    document.addEventListener('DOMContentLoaded', function() {
      const canvases = document.querySelectorAll('canvas');
      canvases.forEach(canvas => {
        canvas.width = 200;
        canvas.height = 200;
      });
    });
  </script>
</body>
</html>
